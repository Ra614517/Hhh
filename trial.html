<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHANG VIP - Trial</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #f72585; --secondary: #4cc9f0; --dark: #0f0f1a; }
        body { background: var(--dark); color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: rgba(255, 255, 255, 0.05); padding: 30px; border-radius: 20px; text-align: center; border: 1px solid var(--primary); width: 320px; }
        .btn-gen { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        #key-box { margin-top: 20px; display: none; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; border: 1px dashed var(--secondary); }
    </style>
</head>
<body>

<div class="card">
    <h2>KHANG <span>VIP</span></h2>
    <p>Generate 2-Hour Trial</p>
    <button id="genBtn" onclick="generateTrial()" class="btn-gen">GENERATE KEY</button>
    <div id="key-box">
        <p id="userD" style="color: var(--secondary); font-weight: bold; margin: 5px 0;"></p>
        <p id="passD" style="color: #fff; margin: 5px 0;"></p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    // Timro real config
    const firebaseConfig = {
        apiKey: "AIzaSyC0VsVrG4T7sEl7nZ4Zd-7OigtKWI3smvA",
        databaseURL: "https://codkhang-c8cb8-default-rtdb.firebaseio.com",
        projectId: "codkhang-c8cb8",
        appId: "1:411020704482:web:861786dd37783eb8d4fcbb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.generateTrial = async () => {
        const btn = document.getElementById('genBtn');
        const fingerprint = btoa(navigator.userAgent).substring(0, 10);
        const now = new Date().getTime();

        if (localStorage.getItem('lock') && (now - localStorage.getItem('lock') < 7200000)) {
             return Swal.fire("Wait!", "Device locked for 2 hours.", "warning");
        }

        btn.disabled = true;
        btn.innerText = "Generating...";

        try {
            const user = "TRIAL-" + Math.floor(1000 + Math.random() * 9000);
            const pass = Math.floor(100 + Math.random() * 899).toString();
            let exp = new Date(); exp.setHours(exp.getHours() + 2);

            await set(ref(db, `userinfo/${user}`), {
                username: user, password: pass, status: "active", validity: exp.toLocaleString(), type: "trial"
            });

            localStorage.setItem('lock', now);
            document.getElementById('key-box').style.display = "block";
            document.getElementById('userD').innerText = "User: " + user;
            document.getElementById('passD').innerText = "Pass: " + pass;
            
            navigator.clipboard.writeText(`User: ${user} Pass: ${pass}`);
            Swal.fire("Success", "Key Copied!", "success");
            btn.innerText = "DONE";
        } catch (e) {
            Swal.fire("Error", "Check Database Rules!", "error");
            btn.disabled = false;
        }
    };
</script>
</body>
</html>
